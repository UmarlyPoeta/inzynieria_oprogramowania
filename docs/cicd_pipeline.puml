@startuml cicd_pipeline
!theme plain
skinparam activity {
  BackgroundColor #E3F2FD
  BorderColor #1976D2
  FontColor #000000
  DiamondBackgroundColor #FFF9C4
  DiamondBorderColor #F57F17
  StartColor #4CAF50
  EndColor #4CAF50
}

start

:GitHub Push;
note right
  • Push to main/develop
  • Pull request
end note

:GitHub Actions\nCI/CD Triggered;

partition "Build and Test Job" {
  :Start MySQL Service\n(Docker Container);
  note right
    MySQL 8.0 image
    Port 3306
    Health check
  end note
  
  :Start Redis Service\n(Docker Container);
  note right
    Redis 7.0 image
    Port 6379
    Session store
  end note
  
  :Load Database Schema\n(NetSimDB.sql + AuthSchema.sql);
  note right
    Network tables (5)
    Auth tables (4)
    Foreign keys
    Indexes
  end note
  
  :Install Dependencies;
  note right
    build-essential, cmake, g++
    libmysqlcppconn-dev
    libcpprest-dev
    nlohmann-json
    hiredis, argon2, jwt-cpp
    yaml-cpp, websocketpp
  end note
  
  :Build C++ Project\n(cmake + make);
  
  :Run Unit Tests\n(61 tests);
  note right
    Network simulation tests
    Database connectivity
    Authentication flow
    Scenario validation
    Environment variables
  end note
}

partition "Performance Tests Job" {
  :Start MySQL + Redis Services;
  
  :Build Performance Tests;
  
  :Run Performance Tests;
  note right
    10 performance tests
    Memory leak check (Valgrind)
    Concurrent access tests
  end note
}

partition "Docker Build Job" {
  :Build Docker Image;
  note right
    Multi-stage build
    MySQL Connector/C++
    Redis, Auth, Scenarios
    Dependencies cached
  end note
  
  :Docker Compose Up\n(Full Stack);
  note right
    netsim container
    mysql container
    redis container
    adminer container
  end note
  
  :Wait for Services\nHealth Check;
  
  :Integration Tests;
  note right
    Enable DB persistence
    Test authentication
    Create test nodes
    Save topology
    Load scenario YAML
    Test WebSocket events
    Verify in MySQL
  end note
  
  if (All tests passed?) then (yes)
    :Docker Compose Down;
  else (no)
    :Show Container Logs;
    :Docker Compose Down;
    stop
  endif
}

partition "Code Quality Job" {
  :Run cppcheck\n(Static Analysis);
  note right
    Warning detection
    Performance issues
    Security checks
    Portability checks
  end note
}

:All Tests Passed (61/61);

stop

@enduml
