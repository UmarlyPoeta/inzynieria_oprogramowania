@startuml production_deployment
!theme plain
skinparam componentStyle rectangle

cloud "Internet" {
  actor User
  actor "Let's Encrypt\nCA" as letsencrypt
}

frame "Production Server" {
  
  package "Docker Compose Production Stack" {
    
    node "Nginx\n(Reverse Proxy)" as nginx <<container>> {
      component "HTTPS\nPort 443" as https
      component "HTTP â†’ HTTPS\nRedirect" as redirect
    }
    note right of nginx
      SSL termination
      Rate limiting
      Security headers
      WebSocket support
    end note
    
    node "Backend\n(NetSimCPP)" as backend <<container>> {
      component "REST API\nPort 8080" as rest
      component "WebSocket\nPort 9001" as ws
      component "Auth Service" as auth
    }
    note right of backend
      JWT validation
      Business logic
      Scenario execution
    end note
    
    node "MySQL\n(Database)" as mysql <<container>> {
      database "Production DB" as db
    }
    note right of mysql
      Persistent volumes
      Automated backups
      Connection pooling
    end note
    
    node "Redis\n(Session Store)" as redis <<container>> {
      storage "Sessions\nCache" as cache
    }
    note right of redis
      JWT sessions
      Rate limiting
      Temporary data
    end note
    
    node "Prometheus\n(Metrics)" as prometheus <<container>> {
      storage "Time Series\nMetrics" as metrics
    }
    
    node "Grafana\n(Monitoring)" as grafana <<container>> {
      component "Dashboards" as dashboards
    }
    note right of grafana
      System metrics
      Application logs
      Alerts
    end note
  }
  
  storage "Volumes" {
    folder "certbot_data/\n(SSL Certificates)" as certs
    folder "mysql_data/\n(Database)" as mysql_vol
    folder "grafana_data/\n(Dashboards)" as grafana_vol
    folder "prometheus_data/\n(Metrics)" as prom_vol
  }
  
  file ".env.production\n(Secrets)" as env
  note right of env
    DB_ROOT_PASSWORD
    JWT_SECRET
    REDIS_PASSWORD
    Generated by generate_secrets.sh
  end note
}

User -down-> redirect : HTTP :80
User -down-> https : HTTPS :443
letsencrypt -down-> nginx : ACME Challenge

https -down-> rest : Proxy
https -down-> ws : WebSocket Upgrade
rest -down-> auth : Validate
rest -down-> db : Query
auth -down-> cache : Session Check
auth -down-> db : User Lookup
rest -down-> cache : Cache

prometheus -up-> rest : Scrape /metrics
prometheus -up-> mysql : Scrape /metrics
grafana -left-> prometheus : Query

nginx -down-> certs : Read Certs
mysql -down-> mysql_vol : Persist
grafana -down-> grafana_vol : Persist
prometheus -down-> prom_vol : Persist

env .up.> mysql : Passwords
env .up.> redis : Passwords
env .up.> backend : JWT Secret

@enduml
