@startuml hybrid_architecture
!theme plain

package "NetSimCPP Hybrid Architecture" {
  
  frame "IN-MEMORY (Fast Operations)" as memory #E8F5E9 {
    component "Network Topology" as topo
    note right of topo
      Current nodes
      Adjacency map
      nodesByName
    end note
    
    component "Packet Queues" as queues
    note right of queues
      Per-node queues
      Congestion control
      Priority queues
    end note
    
    component "Routing Engine" as routing
    note right of routing
      BFS algorithm
      Dijkstra algorithm
      Path computation
    end note
    
    component "Simulation State" as state
    note right of state
      Current time
      Scheduled events
      TCP connections
    end note
    
    component "Scenario State" as scenario
    note right of scenario
      Loaded YAML scenario
      Current step index
      Execution context
    end note
  }
  
  frame "IN DATABASE (Persistent)" as db #E3F2FD {
    database "MySQL 8.0" as mysql {
      storage "Historical\nConfigurations" as history
      storage "Packet Statistics\nover Time" as stats
      storage "Node/Link\nMetadata" as metadata
      storage "VLAN\nConfigurations" as vlans
      storage "Congestion\nRecords" as congestion
      storage "User Accounts\nPermissions" as users
      storage "Auth Audit\nLogs" as audit
    }
    
    database "Redis" as redis {
      storage "JWT Sessions" as sessions
      storage "Rate Limit\nCounters" as ratelimits
    }
  }
  
  component "Synchronization Layer" as sync #FFF9C4
  note right of sync
    Save: Memory to Database
    Load: Database to Memory
    Optional auto-sync
    Transaction support
  end note
  
  component "Auth Layer" as auth #FFE0B2
  note right of auth
    JWT token validation
    Session management
    Password verification
  end note
}

' Connections
memory -down-> sync : saveTopologyToDB()
sync -down-> mysql : INSERT/UPDATE
mysql -up-> sync : SELECT
sync -up-> memory : loadTopologyFromDB()
memory -down-> auth : Check permissions
auth -down-> mysql : User lookup
auth -down-> redis : Session check

note bottom of memory
  Benefits:
  Fast simulation
  Low latency
  Real-time response
  Scenario execution
end note

note bottom of db
  Benefits:
  Survive restarts
  Historical analysis
  Multi-user support
  Backup/Recovery
  Audit trail
end note

@enduml
